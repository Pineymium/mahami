// ============================================
// ADD YOUR FILES HERE - Edit this array weekly
// ============================================
const homeworkFiles = [
    // Example files - replace with your own
    {
        url: 'https://via.placeholder.com/400x600/5D5CDE/ffffff?text=واجب+1',
        subject: 'لغة عربية',
        date: '2025-10-11',
        fileName: 'homework-1.jpg'
    },
    {
        url: 'https://via.placeholder.com/400x600/82ca9d/ffffff?text=واجب+2',
        subject: 'رياضيات',
        date: '2025-10-10',
        fileName: 'homework-2.jpg'
    },
    // Add more files here each week like this:
    // {
    //     url: 'YOUR_IMAGE_URL_HERE',
    //     subject: 'لغة عربية',
    //     date: '2025-10-18',
    //     fileName: 'homework-3.jpg'
    // },
];
// ============================================

// Initialize Lucide icons
lucide.createIcons();

// Dark mode functionality
function initDarkMode() {
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
        if (event.matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    });
}

// Theme toggle
document.getElementById('theme-toggle').addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
});

// Toast notification
function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast px-6 py-4 rounded-lg shadow-lg ${type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white max-w-sm`;
    toast.textContent = message;
    
    document.getElementById('toast-container').appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Render homework cards
function renderHomeworks() {
    const grid = document.getElementById('homework-grid');
    const emptyState = document.getElementById('empty-state');
    
    if (homeworkFiles.length === 0) {
        grid.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
    }
    
    emptyState.classList.add('hidden');
    
    // Sort by date (newest first)
    const sortedFiles = [...homeworkFiles].sort((a, b) => 
        new Date(b.date) - new Date(a.date)
    );
    
    grid.innerHTML = sortedFiles.map((homework, index) => {
        const date = new Date(homework.date);
        const formattedDate = date.toLocaleDateString('ar-SA');
        const isImage = homework.fileName.match(/\.(jpg|jpeg|png|gif)$/i);
        
        return `
            <div class="homework-card bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="aspect-square bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                    ${isImage ? 
                        `<img src="${homework.url}" alt="واجب" class="w-full h-full object-cover">` :
                        `<i data-lucide="file-text" class="w-16 h-16 text-gray-400"></i>`
                    }
                </div>
                
                <div class="p-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium">
                            ${homework.subject}
                        </span>
                        <span class="text-xs text-gray-500 dark:text-gray-400">${formattedDate}</span>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="shareHomework('${homework.url}')" class="flex-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 py-2 px-3 rounded-lg text-sm font-medium hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="share-2" class="w-4 h-4"></i>
                            مشاركة
                        </button>
                        
                        <button onclick="downloadHomework('${homework.url}', '${homework.fileName}')" class="flex-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 py-2 px-3 rounded-lg text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            تحميل
                        </button>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    lucide.createIcons();
}

// Share homework
function shareHomework(url) {
    if (navigator.share) {
        navigator.share({
            title: 'واجب مدرسي',
            text: 'شاهد هذا الواجب',
            url: url
        }).then(() => {
            showToast('تمت المشاركة بنجاح');
        }).catch(() => {
            copyToClipboard(url);
        });
    } else {
        copyToClipboard(url);
    }
}

// Copy to clipboard
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('تم نسخ الرابط');
    }).catch(() => {
        showToast('فشل نسخ الرابط', 'error');
    });
}

// Download homework
function downloadHomework(url, fileName) {
    const link = document.createElement('a');
    link.href = url;
    link.download = fileName;
    link.target = '_blank';
    link.click();
    showToast('تم تحميل الواجب');
}

// Hide upload section since we're not using it
document.addEventListener('DOMContentLoaded', () => {
    const uploadSection = document.querySelector('section.px-4.mb-16.fade-in');
    if (uploadSection) {
        uploadSection.style.display = 'none';
    }
});

// Initialize app
initDarkMode();
renderHomeworks();
